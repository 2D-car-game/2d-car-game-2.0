<!DOCTYPE html>
ctx.stroke();
});
ctx.setLineDash([]);
}


// CAR IMAGES
const playerCarImg=new Image();
playerCarImg.src='https://i.imgur.com/6QxQZQy.png';
const enemyCarImg=new Image();
enemyCarImg.src='https://i.imgur.com/zYxDCQT.png';


function drawCar(x,y,w,h,type='player',tilt=0,nitroOn=false){
ctx.save();
ctx.translate(x+w/2,y+h/2);
ctx.rotate(tilt);
ctx.translate(-w/2,-h/2);


ctx.fillStyle='rgba(0,0,0,0.35)';
ctx.fillRect(4,10,w,h);


const img=type==='player'?playerCarImg:enemyCarImg;
if(img.complete){ctx.drawImage(img,0,0,w,h);}else{ctx.fillStyle='#ff5252';ctx.fillRect(0,0,w,h);}


if(nitroOn){
ctx.fillStyle='orange';
ctx.beginPath();
ctx.moveTo(w/2-6,h);
ctx.lineTo(w/2+6,h);
ctx.lineTo(w/2,h+18);
ctx.fill();
}
ctx.restore();
}


function spawnObstacle(){
const lane=Math.floor(Math.random()*3);
obstacles.push({lane,y:-120,w:50,h:90});
}


function endGame(){
gameStarted=false;
bgMusic.pause();
finalScore.textContent=score;
finalBest.textContent=bestScore;
gameOverScreen.style.display='flex';
}


function update(){
if(!gameStarted){requestAnimationFrame(update);return;}
drawRoad();
drawCar(car.x,car.y,car.w,car.h,'player',0,nitroActive);


for(let i=obstacles.length-1;i>=0;i--){
const o=obstacles[i];
o.y+=speed;
drawCar(lanes[o.lane],o.y,o.w,o.h,'enemy');
if(o.y>600){
obstacles.splice(i,1);
score++;scoreEl.textContent=score;
if(score>bestScore){bestScore=score;localStorage.setItem('bestScore',bestScore);bestEl.textContent=bestScore;}
if(score%5===0){level++;speed++;levelEl.textContent=level;}
}
if(Math.abs(lanes[o.lane]-car.x)<40 && Math.abs(o.y-car.y)<70){crashSound.play();endGame();}
}
requestAnimationFrame(update);
}


startBtn.onclick=()=>{
startScreen.style.display='none';
controls.style.display='flex';
document.getElementById('hud').style.display='block';
gameStarted=true;
bgMusic.play();
};


restartBtn.onclick=()=>location.reload();


// Controls
document.addEventListener('keydown',e=>{
if(!gameStarted) return;
if(e.key==='ArrowLeft'&&currentLane>0){currentLane--;car.x=lanes[currentLane];}
if(e.key==='ArrowRight'&&currentLane<2){currentLane++;car.x=lanes[currentLane];}
});


left.onclick=()=>{if(currentLane>0){currentLane--;car.x=lanes[currentLane];}};
right.onclick=()=>{if(currentLane<2){currentLane++;car.x=lanes[currentLane];}};


nitro.onclick=()=>{
if(nitroActive) return;
nitroActive=true;
speed+=3;
nitro.disabled=true;
setTimeout(()=>{speed-=3;nitroActive=false;nitro.disabled=false;},1500);
};


setInterval(()=>{if(gameStarted) spawnObstacle();},1200);
update();
</script>
</body>
</html>
